!function(){return function e(t,r,i){function n(s,a){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){return n(t[s][1][e]||e)},l,l.exports,e,t,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}}()({1:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r.__esModule=!0,r.Growlytics=void 0;var o=e("./service/customerService"),s=e("./service/eventService"),a=e("./service/initService"),c=e("./service/cartService"),u=e("./onSite/webMessage"),l=e("./service/pushNotification"),g=function(){function e(){}return e.initialize=function(e){return i(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return[4,a.InitService.initialize(e)];case 1:return t.sent(),[2]}})})},e.showMessage=function(e){u.WebMessage.showWebMessageFromJs(e)},e.requestNotificationPermission=function(){l.PushNotification.requestNotificationPermission()},e.user={identify:o.CustomerService.login,push:o.CustomerService.updateAttributes,logout:o.CustomerService.logout},e.events={track:s.EventsService.reportCustomEvent},e.cart={sync:c.CartService.sync},e}();r.Growlytics=g;i(void 0,void 0,void 0,function(){var e,t,r;return n(this,function(i){switch(i.label){case 0:return(e=window.Growlytics)&&e.q?[4,g.initialize(e.input)]:[3,2];case 1:for(i.sent(),window.Growlytics=g,t=0;t<e.q.length;t++)"events.track"==(r=e.q[t]).a?g.events.track.apply(this,r.p):"user.identify"==r.a?g.user.identify.apply(this,r.p):"user.push"==r.a?g.user.push.apply(this,r.p):"showMessage"==r.a?g.showMessage.apply(this,r.p):"cart.sync"==r.a&&g.cart.sync.apply(this,r.p);i.label=2;case 2:return[2]}})})},{"./onSite/webMessage":4,"./service/cartService":5,"./service/customerService":6,"./service/eventService":8,"./service/initService":9,"./service/pushNotification":10}],2:[function(e,t,r){"use strict";r.__esModule=!0,r.MessageStorageSettings=r.PageVisiblityConditionType=r.BehaviourDialogShowType=r.WebMessageType=void 0,function(e){e.Embed="embed",e.Popup="popup",e.Flyout="flyout"}(r.WebMessageType||(r.WebMessageType={})),function(e){e.PageLoad="pageLoad",e.PageExit="pageExit",e.Javascript="javascript"}(r.BehaviourDialogShowType||(r.BehaviourDialogShowType={})),function(e){e.Contains="contains",e.NotContains="not_contains",e.Equals="equal",e.DoesNotEqual="not_equal",e.StartsWith="starts_with",e.EndsWith="ends_with"}(r.PageVisiblityConditionType||(r.PageVisiblityConditionType={}));var i=function(){return function(e){this.converted=!1,e&&(e.hasOwnProperty("lastViewed")&&(this.lastViewed=e.lastViewed),e.hasOwnProperty("converted")&&(this.converted=e.converted))}}();r.MessageStorageSettings=i},{}],3:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r.__esModule=!0,r.OnSiteBase=void 0;var o=e("./../utils/logger"),s=e("./../service/customerService"),a=e("../utils/networkUtil"),c=e("../service/eventService"),u=e("../utils/localStorage"),l=e("../service/sessionService"),g=e("../models/webMessageModel"),d=function(){function e(){}return e.checkMsgEligiblity=function(t,r){return i(this,void 0,void 0,function(){return n(this,function(i){switch(i.label){case 0:return this.isMobileDevice()&&!t.behaviour.deviceVisiblity.mobile?(o.Logger.info("Web message disabled for mobile."),[2,!1]):this.isMobileDevice()||t.behaviour.deviceVisiblity.desktop?[4,this._isAllowedForVisitorType(t,r)]:(o.Logger.info("Web message disabled for desktop."),[2,!1]);case 1:return i.sent()&&this._isPageAllowed(t)?t.checkBehvaiour?[4,e._isBehaviourQualified(t)]:[3,3]:[2,!1];case 2:if(!i.sent())return[2,!1];i.label=3;case 3:return t.behaviour.dontShowToConverted&&(t.storageSettings.converted||s.CustomerService.isAlreadyIdentified())?[2,!1]:[4,this._isAllowedForFrequency(t)];case 4:return i.sent()?[2,!0]:[2,!1]}})})},e._isAllowedForFrequency=function(e){return i(this,void 0,void 0,function(){var t,r,i;return n(this,function(n){return"all_time"==e.behaviour.frequency.type?[2,!0]:"once"==e.behaviour.frequency.type?e.storageSettings.lastViewed?[2,!1]:[2,!0]:(t=parseInt(e.behaviour.frequency.type),r=60*t*60,e.storageSettings.lastViewed?(i=this.getCurrentTimestamp(),[2,i-e.storageSettings.lastViewed>=r]):[2,!0])})})},e._isAllowedForVisitorType=function(e,t){return i(this,void 0,void 0,function(){var r;return n(this,function(i){return"all"==(r=e.behaviour.visitorType)?[2,!0]:"new"==r?[2,1==t]:"returning"==r?[2,0==t]:[2,!1]})})},e._isBehaviourQualified=function(e){return i(this,void 0,void 0,function(){return n(this,function(t){return[2,new Promise(function(t){var r={glytics_id:e.id,glytics_type:"popup"};a.NetworkUtil.postToOldDc("/wmsg/ce",r,function(e){t(e)},function(e){o.Logger.error("Failed to check user past behaviour for web message.",e),t(!1)})})]})})},e._isPageAllowed=function(e){if("specific"!=e.behaviour.page.type)return!0;if(0==e.behaviour.page.pageList.length)return!0;for(var t=window.location.pathname,r=0;r<e.behaviour.page.pageList.length;r++)if(e.behaviour.page.pageList[r].filter==g.PageVisiblityConditionType.DoesNotEqual){if(t==e.behaviour.page.pageList[r].value)return!1}else if(e.behaviour.page.pageList[r].filter==g.PageVisiblityConditionType.NotContains&&t.indexOf(e.behaviour.page.pageList[r].value)>=0)return!1;var i=0;for(r=0;r<e.behaviour.page.pageList.length;r++)if(e.behaviour.page.pageList[r].filter==g.PageVisiblityConditionType.Equals){if(i++,t==e.behaviour.page.pageList[r].value)return!0}else if(e.behaviour.page.pageList[r].filter==g.PageVisiblityConditionType.Contains){if(i++,t.indexOf(e.behaviour.page.pageList[r].value)>=0)return!0}else if(e.behaviour.page.pageList[r].filter==g.PageVisiblityConditionType.StartsWith){if(i++,t.startsWith(e.behaviour.page.pageList[r].value))return!0}else if(e.behaviour.page.pageList[r].filter==g.PageVisiblityConditionType.EndsWith&&(i++,t.endsWith(e.behaviour.page.pageList[r].value)))return!0;return 0==i},e.onMessageViewed=function(e){e.storageSettings.lastViewed=this.getCurrentTimestamp(),this.updateSettingsForMessage(e,e.storageSettings);var t={glytics_id:e.id,glytics_type:"popup"};a.NetworkUtil.postToOldDc("/wmsg/view",t,function(){},function(e){o.Logger.error("Failed to report web message delivery.",e)})},e.onMessageConverted=function(e,t){return i(this,void 0,void 0,function(){var r,i,u,l,g;return n(this,function(n){switch(n.label){case 0:if(!t)return[3,2];if(e.generalSettings.customerFields)for(r=0;r<e.generalSettings.customerFields.length;r++)i=e.generalSettings.customerFields[r].key,u=e.generalSettings.customerFields[r].value,t[i]=u;return(l=new s.AdditionalCustomerUpdateSettings).updateUrl="/wmsg/submit",l.formId=e.id,[4,s.CustomerService.updateAttributes(t)];case 1:n.sent(),g={glytics_id:e.id,glytics_type:"popup"},a.NetworkUtil.postToOldDc("/wmsg/convert",g,function(){},function(e){o.Logger.error("Failed to report web message conversion.",e)}),e.behaviour.trackingEvent&&c.EventsService.reportCustomEvent(e.behaviour.trackingEvent,t),e.storageSettings.converted=!0,this.updateSettingsForMessage(e,e.storageSettings),n.label=2;case 2:return[2]}})})},e.getSettingsForMessage=function(){var e=u.LocalStorage.getItem(u.StorageKeys.WebMessageState);if(!e)return{};e=atob(e);try{e=JSON.parse(e)}catch(e){return{}}return e},e.updateSettingsForMessage=function(e,t){var r=this.getSettingsForMessage();r[e.id]=t;var i=JSON.stringify(r);i=btoa(i),u.LocalStorage.setItem(u.StorageKeys.WebMessageState,i)},e.isFirstTimeVisitor=function(){var e=l.SessionService.getCurrentSession().id,t=u.LocalStorage.getItem(u.StorageKeys.VisitorType);return(!t||"1"!=t)&&(!t||t==e)},e.isMobileDevice=function(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)},e.setFirstTimeVisitorFalse=function(){var e=l.SessionService.getCurrentSession().id;u.LocalStorage.getItem(u.StorageKeys.VisitorType)||u.LocalStorage.setItem(u.StorageKeys.VisitorType,e)},e.getCurrentTimestamp=function(){return Math.floor(Date.now()/1e3)},e}();r.OnSiteBase=d},{"../models/webMessageModel":2,"../service/eventService":8,"../service/sessionService":11,"../utils/localStorage":16,"../utils/networkUtil":18,"./../service/customerService":6,"./../utils/logger":17}],4:[function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r.__esModule=!0,r.WebMessage=void 0;var a=e("../utils/config"),c=e("../utils/endpointService"),u=e("../utils/logger"),l=e("./../models/webMessageModel"),g=e("./onSiteBase"),d="WebMessages:",f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.saveListAtPageLoad=function(e){this.popupMessageList=[],this.embedMessageList={};for(var t=this.getSettingsForMessage(),r=0;r<e.length;r++){var i=e[r],n=new l.MessageStorageSettings(t[i.id]);i.storageSettings=n,"embed"==i.type?this.embedMessageList[i.id]=i:this.popupMessageList.push(i)}u.Logger.info(d,this.popupMessageList.length,Object.keys(this.embedMessageList).length)},t.pageLoadSync=function(e){return o(this,void 0,void 0,function(){var e,r,i,n;return s(this,function(o){switch(o.label){case 0:o.trys.push([0,6,,7]),u.Logger.info(d,"Configured:",this.popupMessageList.length,Object.keys(this.embedMessageList).length),this.firstTimeVisitor=this.isFirstTimeVisitor(),this.scrollPopupQueue=[],this.exitPopupQueue=[],e=0,o.label=1;case 1:return e<this.popupMessageList.length?(r=this.popupMessageList[e],[4,this.checkMsgEligiblity(r,this.firstTimeVisitor)]):[3,5];case 2:return i=o.sent(),u.Logger.info("Web Message Settings: Eligible:",i,r.id),i?[4,t._renderWebMessage(r)]:[3,4];case 3:o.sent(),o.label=4;case 4:return e++,[3,1];case 5:return this.setFirstTimeVisitorFalse(),this.onPageScrolled(),window.removeEventListener("scroll",this.onPageScrolled),window.addEventListener("scroll",this.onPageScrolled),this._handleEmbededMessageLogic(),[3,7];case 6:return n=o.sent(),u.Logger.error("Failed to handle webmessages.",n),[3,7];case 7:return[2]}})})},t._handleEmbededMessageLogic=function(){return o(this,void 0,void 0,function(){var e,t,r;return s(this,function(i){return this.mutationObserverAdded||(e=new MutationObserver(this._mutationObserverCallback),t=document.body,r={attributes:!0,childList:!0,characterData:!0},e.observe(t,r),this.mutationObserverAdded=!0),this._mutationObserverCallback(null),[2]})})},t.showWebMessageFromJs=function(e){return o(this,void 0,void 0,function(){var t;return s(this,function(r){switch(r.label){case 0:return a.Config.isEnabled()?(t=this.jsWebMessageCache[e])?[4,this.checkMsgEligiblity(t,this.firstTimeVisitor)]:(u.Logger.error("Web message with id "+e+" not found. Please provide valid message id."),[2]):(u.Logger.warn("Growlytics.showMessage() callled, but growlytics is disabled."),[2]);case 1:return r.sent()?(this._addWebMessageIframe(t),[2]):(u.Logger.error("Web message with message-id "+e+" called. But its not eligible to display according to display settings."),[2])}})})},t._renderWebMessage=function(e){var t=this;if(e.behaviour.when.type==l.BehaviourDialogShowType.PageLoad)if("timer"==e.behaviour.when.pageLoad.showType){var r=1e3*parseInt(e.behaviour.when.pageLoad.timer);u.Logger.info(d,"Render Popup After ",r,e.id),setTimeout(function(){t._addWebMessageIframe(e)},r)}else"scroll"==e.behaviour.when.pageLoad.showType?(u.Logger.info(d,"Render Popup When Scrolled ",e.id),this.scrollPopupQueue.push(e)):(u.Logger.info(d,"Render Popup Now. ",e.id),this._addWebMessageIframe(e));else if(e.behaviour.when.type==l.BehaviourDialogShowType.PageExit){var i=function(r){null==r.relatedTarget&&"select"!==r.target.nodeName.toLowerCase()&&(document.removeEventListener("mouseout",i),t._addWebMessageIframe(e))};u.Logger.info(d,"Render Popup On Mouse Out. ",e.id),document.addEventListener("mouseout",i)}else u.Logger.info(d,"Render Popup With Javascript method only. ",e.id),this.jsWebMessageCache[e.id]=e},t._addWebMessageIframe=function(e,r){void 0===r&&(r=null);try{if(u.Logger.info(d,"Start: Add Web Message.",e.id),e.type==l.WebMessageType.Popup){if(this.currentPopup)return void this.finalPopupQueue.push(e);this.currentPopup=e}delete e.content,delete e.thankyou_content;var i={message:"growlytics-show-web-message",data:e,id:e.id,parentWidth:window.document.body.clientWidth},n="grw-web-message-"+e.id,o=document.createElement("iframe");o.setAttribute("id",n),o.setAttribute("src",this._getIframeContentUrl()),o.setAttribute("allow","clipboard-read; clipboard-write"),o.style.opacity="0",o.style.width="100%",o.style.border="none",o.style.background="transparent",e.type!=l.WebMessageType.Embed&&(o.style["z-index"]="999999999999",o.style.height="100vh"),o.onload=function(){u.Logger.info(d,"Rendering Popup.",e.id),o.contentWindow.postMessage(i,"*")},window.addEventListener("message",t.handleIframeMessage,!1),r?r.appendChild(o):document.body.appendChild(o),t.onMessageViewed(e),u.Logger.info(d,"End: Added Web Message.",e.id)}catch(t){u.Logger.error(d,"Failed to render popup.",e.id,t)}},t.handleIframeMessage=function(e){var r=e.data,i=r.action,n=r.data;if(r&&"Growlytics"==r.source)if("growlytics-message-resize"==i){var o=document.getElementById("grw-web-message-"+n.id);o&&(n.isPopup?(o.style.position="fixed",o.style.left="0",o.style.right="0",o.style.top="0",o.style.bottom="0",o.style.width="100%",o.style.height="100vh"):n.isFlyout?(o.style.width=n.width,o.style.height=n.height,o.style.position="fixed",o.style.top="auto",o.style.bottom="auto",n.isMobileMode?(o.style.left="0",o.style.right="0",o.style.width="100%"):("100%"==o.style.width?(o.style.left="0",o.style.right="0"):(o.style.left="auto",o.style.right="auto"),"left"==n.flyoutPosition.x?o.style.left="20px":"right"==n.flyoutPosition.x?o.style.right="20px":"center"==n.flyoutPosition.x&&(o.style.margin="auto",o.style.left="0",o.style.right="0")),"top"==n.flyoutPosition.y?o.style.top="20px":"bottom"==n.flyoutPosition.y&&(o.style.bottom="20px")):n.isEmbed&&(o.style.position="relative",o.style.width="100%",o.style.height=n.height),o.style.opacity="1")}else"growlytics-close-popup"==i?t.handlePopupClose(n.webMessageId):"growlytics-form-submitted"==i&&t.onMessageConverted(n.webMessage,n.formFields)},t.handlePopupClose=function(e){var t=this,r="grw-web-message-"+e;document.getElementById(r).remove(),this.currentPopup=null,this.finalPopupQueue.length>0&&setTimeout(function(){var e=t.finalPopupQueue.shift();t._addWebMessageIframe(e)},15e3)},t.onPageScrolled=function(){return o(this,void 0,void 0,function(){return s(this,function(e){return t.scrollThrottlingTimer&&window.clearTimeout(t.scrollThrottlingTimer),t.scrollThrottlingTimer=window.setTimeout(function(){var e=this;if(t.processingScrollQueue)setTimeout(function(){e.onPageScrolled()},1e3);else{t.processingScrollQueue=!0;try{var r=100;document.documentElement.scrollHeight!=window.innerHeight&&(r=Math.floor(document.documentElement.scrollTop/(document.documentElement.scrollHeight-window.innerHeight)*100));for(var i=[],n=t.scrollPopupQueue,o=0;o<n.length;o++){var s=t.scrollPopupQueue[o];parseInt(s.behaviour.when.pageLoad.scroll)<=r?t._addWebMessageIframe(s):i.push(s)}t.scrollPopupQueue=i,t.processingScrollQueue=!1}catch(e){t.processingScrollQueue=!1,u.Logger.error(d,"Rendering failed.",e)}}},300),[2]})})},t._getIframeContentUrl=function(){return c.EndpointService.getHostForWebMessage()},t._mutationObserverCallback=function(e){for(var r=document.querySelectorAll(".grltcs-embed:not(.grltcs-embed-done)"),i=function(e){r[e].classList.forEach(function(i){if(i.startsWith("grltcs-embed-")){var n=i.replace("grltcs-embed-","");t.embedMessageList[n]&&(r[e].classList.add("grltcs-embed-done"),t._addWebMessageIframe(t.embedMessageList[n],r[e]))}})},n=0;n<r.length;n++)i(n)},t.currentPopup=null,t.finalPopupQueue=[],t.jsWebMessageCache={},t.mutationObserverAdded=!1,t.embedMessageList={},t.processingScrollQueue=!1,t}(g.OnSiteBase);r.WebMessage=f},{"../utils/config":13,"../utils/endpointService":14,"../utils/logger":17,"./../models/webMessageModel":2,"./onSiteBase":3}],5:[function(e,t,r){"use strict";r.__esModule=!0,r.CartService=void 0;var i=e("./../utils/config"),n=e("./../utils/logger"),o=e("../utils/networkUtil"),s=function(){function e(){}return e.sync=function(e){try{if(!i.Config.isEnabled())return void n.Logger.warn("Growlytics.cart.sync() called, but growlytics is disabled.");o.NetworkUtil.postToOldDc("/cart/sync",e,function(){n.Logger.info("Cart synced successfully.")},function(e,t,r){n.Logger.error("Cart Sync Failed.",e,r.details?r.details:void 0)})}catch(e){n.Logger.error(e)}},e.clear=function(){try{if(!i.Config.isEnabled())return void n.Logger.warn("Growlytics.cart.clear() called, but growlytics is disabled.");o.NetworkUtil.postToOldDc("/cart/sync",{},function(e){n.Logger.info("User attributes set successfully.")},function(e){n.Logger.info("Failed to sent user properties."),n.Logger.error(e)})}catch(e){n.Logger.error(e)}},e}();r.CartService=s},{"../utils/networkUtil":18,"./../utils/config":13,"./../utils/logger":17}],6:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r.__esModule=!0,r.CustomerService=r.AdditionalCustomerUpdateSettings=void 0;var o=e("../utils/config"),s=e("../utils/localStorage"),a=e("../utils/logger"),c=e("../utils/util"),u=e("../utils/networkUtil"),l=e("./deviceService"),g=e("./sessionService"),d=e("./initService"),f=function(){return function(){}}();r.AdditionalCustomerUpdateSettings=f;var p=function(){function e(){}return e.isAlreadyIdentified=function(){return!!s.LocalStorage.getItem(s.StorageKeys.CustomerIdentified)},e.setAlreadyIdentified=function(e){s.LocalStorage.setItem(s.StorageKeys.CustomerIdentified,"1");var t=s.LocalStorage.getState();t.systemId=e,t.sidTimestamp=(new Date).valueOf(),s.LocalStorage.setState(t)},e.login=function(t,r){return i(this,void 0,void 0,function(){var i,s,u,d,f;return n(this,function(n){switch(n.label){case 0:if(n.trys.push([0,5,,6]),!o.Config.isEnabled())return a.Logger.warn("Growlytics.user.idenfify() called, but growlytics is disabled."),[2];if(!t)return a.Logger.reportLogToServer(["Identify Customer Ignored. System id not provided.",t,JSON.stringify(r)]),a.Logger.error("Identify Customer Ignored. System id not provided."),[2];if("string"!=typeof t)return a.Logger.reportLogToServer(["Identify Customer Ignored. System id must be a string.",t,JSON.stringify(r)]),a.Logger.error("Identify Customer Ignored. System id must be a string. "),[2];if(t.length>40)return a.Logger.reportLogToServer(["Identify Customer Ignored. System id can not exceed 40 characters.",t,JSON.stringify(r)]),a.Logger.error("Identify Customer Ignored. System id can not exceed 40 characters."),[2];if(i=null,r){if(i=r,!(s=e._validateUserProps(i,!1)).success)return a.Logger.reportLogToServer(["Failed to login user. Invalid input.",t,s.msg]),a.Logger.error("Failed to login user. Invalid input.",s.msg),[2];i=s.transformed}return(u=e.getSystemId())&&u==t?[4,e.updateAttributes(r)]:[3,2];case 1:return n.sent(),[3,4];case 2:return d={id:l.DeviceService.getDeviceId(),user:{id:t,attributes:i},session:g.SessionService.getCurrentSession(),meta:c.UtilService.buildDeviceMetaForReportingEvent()},a.Logger.reportLogToServer(["info","Login: New Request: ",t]),[4,e._reportLoginToServer(d,t,0)];case 3:n.sent(),n.label=4;case 4:return[3,6];case 5:return f=n.sent(),a.Logger.reportLogToServer(["error","Login: Failed",t]),a.Logger.reportLogToServer(["error","Login: Failed Error",t,f]),a.Logger.error("Failed to identify customer.",f),[3,6];case 6:return[2]}})})},e._reportLoginToServer=function(t,r,o){return void 0===o&&(o=0),i(this,void 0,void 0,function(){var i;return n(this,function(n){switch(n.label){case 0:return t.id?[3,4]:o<20?(0!=o&&o%5!=0||a.Logger.reportLogToServer(["warning","Login: Wait For DeviceId:",o,r]),[4,c.UtilService.sleep(500)]):[3,3];case 1:return n.sent(),o++,[4,e._reportLoginToServer(t,r,o)];case 2:return n.sent(),[2];case 3:return a.Logger.reportLogToServer(["error","Login: Failed: Device profile not found",r]),[2];case 4:return a.Logger.reportLogToServer(["info","Login: Calling Server API Call",r]),[4,u.NetworkUtil.post(u.UrlList.Login,t)];case 5:return(i=n.sent()).success?(e.setAlreadyIdentified(r),a.Logger.reportLogToServer(["info","Login: Finished",r])):a.Logger.reportLogToServer(["error","Login: Failed",i]),[2]}})})},e.getSystemId=function(){var e=s.LocalStorage.getState();return e?e.systemId:null},e.logout=function(){return i(this,void 0,void 0,function(){var t,r;return n(this,function(i){try{if(!o.Config.isEnabled())return a.Logger.warn("Growlytics.user.logout() callled, but growlytics is disabled."),[2];if(e.isAlreadyIdentified()){for(r in t={id:l.DeviceService.getDeviceId(),sid:e.getSystemId(),session:g.SessionService.getCurrentSession(),meta:c.UtilService.buildDeviceMetaForReportingEvent()},u.NetworkUtil.post(u.UrlList.Logout,t),localStorage)r.startsWith(s.LocalStorage.prefix)&&window.localStorage.removeItem(r);d.InitService.performPageLoadActions()}}catch(e){a.Logger.info("Failed to logout customer.",e)}return[2]})})},e.updateAttributes=function(t){return i(this,void 0,void 0,function(){var r,i,s,d;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),o.Config.isEnabled()?(r=e._validateUserProps(t,!1)).success?(i=r.transformed,s={id:l.DeviceService.getDeviceId(),sid:e.getSystemId(),data:i,session:g.SessionService.getCurrentSession(),meta:c.UtilService.buildDeviceMetaForReportingEvent()},[4,u.NetworkUtil.post(u.UrlList.UpdateCustomerAttrs,s)]):(a.Logger.error("Failed to push user properties.",r.msg),[2]):(a.Logger.warn("Growlytics.user.push() called, but growlytics is disabled."),[2]);case 1:return n.sent(),[3,3];case 2:return d=n.sent(),a.Logger.error("Failed to update customer attributes.",d),[3,3];case 3:return[2]}})})},e._validateUserProps=function(e,t){var r,i={success:!0,msg:null,transformed:[]};if(void 0===e||null==e&&!t)i.success=!1,i.msg="User object can not be null.";else if((r=e)instanceof Date||"object"!=typeof r||null===r||r instanceof Array)i.success=!1,i.msg="Invalid user object. It must be a key value pair.";else for(var n=Object.keys(e),o=0;o<n.length;o++){var s=e[n[o]],a={name:n[o],value:s,type:null};if("string"==typeof s)a.type="string";else if("boolean"==typeof s)a.type="boolean";else if("number"==typeof s)a.type="number";else{if(!(s instanceof Date))continue;a.type="date"}i.transformed.push(a)}return i},e}();r.CustomerService=p},{"../utils/config":13,"../utils/localStorage":16,"../utils/logger":17,"../utils/networkUtil":18,"../utils/util":19,"./deviceService":7,"./initService":9,"./sessionService":11}],7:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r.__esModule=!0,r.DeviceService=void 0;var o=e("./../utils/util"),s=e("../utils/networkUtil"),a=e("../utils/localStorage"),c=e("../utils/config"),u=function(){function e(){}return e.createAndReportNewDevice=function(){return i(this,void 0,void 0,function(){var e,t,r;return n(this,function(i){switch(i.label){case 0:return e=o.UtilService.uuid(),e+="-grw",this.saveDeviceId(e),t={id:e,urlPath:window.location.pathname?window.location.pathname.toString().substring(0,249):"",ua:window.navigator.userAgent},[4,s.NetworkUtil.post(s.UrlList.DeviceRegisteration,t)];case 1:return r=i.sent(),[4,o.UtilService.sleep(200)];case 2:return i.sent(),[2,r]}})})},e.getDeviceId=function(){var e=a.LocalStorage.getState();return e&&e.did?e.did:null},e.saveDeviceId=function(e){var t=a.LocalStorage.getState();t||(t=new a.LocalState),t.did=e,t.didTimestamp=(new Date).valueOf(),t.apiKey=c.Config.getApiKey(),a.LocalStorage.setState(t);var r=new Date;r.setTime(r.getTime()+15552e7);var i="; expires="+r.toUTCString();document.cookie="_gl_did="+e+i+"; path=/"},e}();r.DeviceService=u},{"../utils/config":13,"../utils/localStorage":16,"../utils/networkUtil":18,"./../utils/util":19}],8:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r.__esModule=!0,r.EventsService=void 0;var o=e("../utils/util"),s=e("../utils/networkUtil"),a=e("./sessionService"),c=e("./deviceService"),u=e("../utils/logger"),l=e("../utils/config"),g=e("./customerService"),d=function(){function e(){}return e.reportPageVisitEvent=function(){return i(this,void 0,void 0,function(){var e,t;return n(this,function(r){switch(r.label){case 0:e=null;try{e=o.UtilService.readSourceForTracking().referrer}catch(t){e="direct"}return(t={name:"GRW_SYSTEM_EVENT_PAGE_VISITED",properties:[],rawProperties:{url:window.location.pathname?window.location.pathname.toString().substring(0,249):"",trafficSource:e}}).properties.push({name:"url",value:t.rawProperties.url,type:"string"}),t.properties.push({name:"trafficSource",value:t.rawProperties.trafficSource,type:"string"}),[4,this._reportEventToServer(t)];case 1:return r.sent(),[2]}})})},e.reportUtmVisited=function(){return i(this,void 0,void 0,function(){var e,t,r;return n(this,function(i){switch(i.label){case 0:e=null;try{t=o.UtilService.readSourceForTracking(),e=t.utm}catch(e){return[2]}return e&&(e.us||e.um||e.uc)?((r={name:"GRW_SYSTEM_EVENT_UTM_VISITED",properties:[],rawProperties:{source:e.us,medium:e.um,campaign:e.uc}}).properties.push({name:"source",value:r.rawProperties.source,type:"string"}),r.properties.push({name:"medium",value:r.rawProperties.medium,type:"string"}),r.properties.push({name:"campaign",value:r.rawProperties.campaign,type:"string"}),[4,this._reportEventToServer(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.reportCustomEvent=function(t,r){return i(this,void 0,void 0,function(){var i,o,s,a,d,f,p,h,v;return n(this,function(n){switch(n.label){case 0:if(n.trys.push([0,2,,3]),!l.Config.isEnabled())return u.Logger.warn("Growlytics.events.track() callled, but growlytics is disabled."),[2];if(u.Logger.reportLogToServer(["New Event Request:",t,JSON.stringify(r),c.DeviceService.getDeviceId(),g.CustomerService.getSystemId()]),"string"!=typeof t)throw new Error("Growlytics: Event name must be of type String.");if(t.length>120)throw new Error('Growlytics: Event name "'+t+'" can not exceed 120 characters.');if(i=Object.keys(r),r){if("object"!=typeof r)throw new Error("Growlytics: Event property parameter must be an object. "+typeof r+" provided.");if(i.length>100)throw new Error("Growlytics: Maximum 100 properties are allowed for given event. "+Object.keys(r)+" provided.");if(i.length>100)throw new Error("Growlytics: Maximum 100 properties are allowed for given event. "+i+" provided.")}for(o=[],s=0;s<i.length;s++){if("string"!=typeof(a=i[s]))throw new Error("Growlytics: Invalid event properties. Event property keys must be of type string.");if(d=r[a],f=typeof d,null!=d)if("number"===f)o.push({name:a,value:d.toString(),type:"number"});else if("boolean"===f)o.push({name:a,value:d?1:0,type:"boolean"});else if(d instanceof Date)p=[d.getFullYear(),d.getMonth()+1,d.getDate()].join("-"),p+=" "+[d.getHours(),d.getMinutes(),d.getSeconds()].join(":"),o.push({name:a,value:p,type:"date"});else{if("string"!=f)throw new Error("Growlytics: Invalid value for event proeprty: "+a+". Allowed property types are number, boolean, string and date.");if(d.length>512)throw new Error("Growlytics: Invalid event property '"+a+"'. Property value can not exceed 512 characters. "+d.length+" provided.");o.push({name:a,value:d.toString(),type:"string"})}}return u.Logger.info("Report event",t,o),h={name:t,properties:o,rawProperties:r},[4,e._reportEventToServer(h)];case 1:return n.sent(),u.Logger.info("Event reported sucessfully."),[3,3];case 2:return v=n.sent(),u.Logger.error("Failed to report event.",v),u.Logger.reportLogToServer(["Event Track Failed:",t,JSON.stringify(r),c.DeviceService.getDeviceId(),g.CustomerService.getSystemId(),v]),[3,3];case 3:return[2]}})})},e._reportEventToServer=function(e,t){return void 0===t&&(t=0),i(this,void 0,void 0,function(){var r;return n(this,function(i){switch(i.label){case 0:return(r={id:c.DeviceService.getDeviceId(),sid:g.CustomerService.getSystemId(),event:e,session:a.SessionService.getCurrentSession(),meta:o.UtilService.buildDeviceMetaForReportingEvent()}).id?[3,4]:t<20?(0!=t&&t%5!=0||u.Logger.reportLogToServer(["warning","New Event: Wait For DeviceId:",t,e]),[4,o.UtilService.sleep(500)]):[3,3];case 1:return i.sent(),t++,[4,this._reportEventToServer(e,t)];case 2:return i.sent(),[2];case 3:return u.Logger.reportLogToServer(["error","Device profile not found for event reporting.",r]),[2];case 4:return[4,s.NetworkUtil.post(s.UrlList.NewEvent,r)];case 5:return i.sent(),[2]}})})},e}();r.EventsService=d},{"../utils/config":13,"../utils/logger":17,"../utils/networkUtil":18,"../utils/util":19,"./customerService":6,"./deviceService":7,"./sessionService":11}],9:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};r.__esModule=!0,r.InitService=void 0;var s=e("../utils/config"),a=e("../utils/endpointService"),c=e("../utils/localStorage"),u=e("../utils/logger"),l=e("../utils/networkUtil"),g=e("./../onSite/webMessage"),d=e("./../service/pushNotification"),f=e("./deviceService"),p=e("./eventService"),h=e("./sessionService"),v=o(e("./../utils/isBot")),y=function(){function e(){}return e.initialize=function(e){return i(this,void 0,void 0,function(){var t,r;return n(this,function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),t=navigator.userAgent,v.default(t)?(console.log("Growlytics: Bot detected. Disabling Growlytics."),s.Config.setEnabled(!1),[2]):window.GrowlyticsInitialized?(u.Logger.error("Growlytics is already initialized. Ignoring initialze() request."),[2,null]):(window.GrowlyticsInitialized=!0,s.Config.mergeOptions(e),[4,this._checkForApiKeyChange()]);case 1:return i.sent(),this._registerPageChangeEventHandler(),s.Config.isEnabled()?[4,this._fetchSdkSettingsFromNetwork()]:(u.Logger.warn("Disabled from configuration."),[2]);case 2:return(r=i.sent()).enabled?(d.PushNotification.saveSettingsAtPageLoad(r.vapid),g.WebMessage.saveListAtPageLoad(r.messages),[4,this.performPageLoadActions()]):(u.Logger.error("Growlytics account is not active. Please contact Growlytics support."),s.Config.setEnabled(!1),[2]);case 3:return i.sent(),[4,g.WebMessage.pageLoadSync(window.location.pathname)];case 4:return i.sent(),[4,d.PushNotification.pageLoadCheck()];case 5:return i.sent(),[3,7];case 6:return i.sent(),u.Logger.error("Failed to initialize Growlytics script. Please contact support."),s.Config.setEnabled(!1),[3,7];case 7:return[2]}})})},e.performPageLoadActions=function(){return i(this,void 0,void 0,function(){var e,t,r;return n(this,function(i){switch(i.label){case 0:return e=c.LocalStorage.getState(),t=e&&!e.didTimestamp,f.DeviceService.getDeviceId()&&!t?[3,2]:[4,f.DeviceService.createAndReportNewDevice()];case 1:if(!i.sent().success)return u.Logger.error("Profile creation failed. Please contact Growlytics support."),s.Config.setEnabled(!1),[2];f.DeviceService.getDeviceId(),i.label=2;case 2:return h.SessionService.isValidSession()&&!t?[3,4]:[4,h.SessionService.createAndReportNewSession()];case 3:i.sent(),i.label=4;case 4:return h.SessionService.extendExpiryTime(),p.EventsService.reportPageVisitEvent(),p.EventsService.reportUtmVisited(),(r=c.LocalStorage.getState())&&(r.apiKey=s.Config.getApiKey(),c.LocalStorage.setState(r)),[2]}})})},e._checkForApiKeyChange=function(){return i(this,void 0,void 0,function(){var e;return n(this,function(t){return(e=c.LocalStorage.getState())&&s.Config.getApiKey()!=e.apiKey&&(c.LocalStorage.removeItem(c.StorageKeys.LocalStorageData),c.LocalStorage.removeItem(c.StorageKeys.SessionInfo)),[2]})})},e._registerPageChangeEventHandler=function(){var e;s.Config.isEnabled()&&(history.pushState=(e=history.pushState,function(){var t=e.apply(this,arguments);return window.dispatchEvent(new Event("pushState")),window.dispatchEvent(new Event("locationchange")),t}),history.replaceState=function(e){return function(){var t=e.apply(this,arguments);return window.dispatchEvent(new Event("replaceState")),window.dispatchEvent(new Event("locationchange")),t}}(history.replaceState),window.addEventListener("popstate",function(){window.dispatchEvent(new Event("locationchange"))}),window.addEventListener("locationchange",function(){s.Config.isEnabled()}))},e._fetchSdkSettingsFromNetwork=function(){return i(this,void 0,void 0,function(){var e,t,r,i,o,s,g;return n(this,function(n){switch(n.label){case 0:return!(e=c.LocalStorage.getItem(c.StorageKeys.SdkSettings))||(e=atob(e),e=JSON.parse(e),t=e.data,r=e.expiryTime,i=Date.now(),r<i)?(u.Logger.info("Setting cache has expired or not found, fetching settings from network."),[4,l.NetworkUtil.post(l.UrlList.WebSdkSettings,{domain:window.location.host?window.location.host.replace("www.",""):window.location.host,path:window.location.pathname},a.EndpointService.getHostForCache())]):[2,t];case 1:return o=n.sent(),s=o.data,g={data:s,expiryTime:Date.now()+6e4},c.LocalStorage.setItem(c.StorageKeys.SdkSettings,btoa(JSON.stringify(g))),u.Logger.info("Settings saved in cache.",Date.now(),g.expiryTime),[2,s]}})})},e}();r.InitService=y},{"../utils/config":13,"../utils/endpointService":14,"../utils/localStorage":16,"../utils/logger":17,"../utils/networkUtil":18,"./../onSite/webMessage":4,"./../service/pushNotification":10,"./../utils/isBot":15,"./deviceService":7,"./eventService":8,"./sessionService":11}],10:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r.__esModule=!0,r.PushNotification=void 0;var o=e("./../utils/config"),s=e("./../utils/localStorage"),a=e("./../utils/logger"),c=e("./../onSite/onSiteBase"),u=e("./../utils/util"),l=e("../utils/networkUtil"),g=e("./deviceService"),d=function(){function e(){}return e.saveSettingsAtPageLoad=function(t){e.settings=t},e.prototype.updateDeviceDetailsInServiceWorker=function(){},e.pageLoadCheck=function(){return i(this,void 0,void 0,function(){return n(this,function(t){return e.settings.enabled?(e.requestNotificationPermission(),[2]):(a.Logger.warn("Push Notification: Web push notifcations are disabled from dashboard."),[2])})})},e.requestNotificationPermission=function(){return i(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return o.Config.isEnabled()?"serviceWorker"in navigator?(a.Logger.info("Push Notification: Permission:",Notification.permission),"granted"!=Notification.permission?[3,1]:(this._registerServiceWorker(),[3,8])):(a.Logger.warn("Push Notification: Browser does not support push notification."),[2]):(a.Logger.warn("Push Notification: Don't ask for notifcation permission, growlytics is disabled."),[2]);case 1:return"default"!=Notification.permission?[3,8]:(a.Logger.info("Push Notification: Requesting permission."),this.settings.theme.showAfterSeconds?[4,u.UtilService.sleep(1e3*this.settings.theme.showAfterSeconds)]:[3,3]);case 2:e.sent(),e.label=3;case 3:return"one-step"!=this.settings.theme.optinType?[3,5]:[4,this._showPermissionBrowserDialog()];case 4:return e.sent(),[3,8];case 5:return"self-hosted"!=this.settings.theme.optinType?[3,6]:[3,8];case 6:return[4,this._showWebPushRequestUi(this.settings.theme)];case 7:e.sent(),e.label=8;case 8:return[2]}})})},e._saveSubscriptionInfo=function(t){return i(this,void 0,void 0,function(){var r,i,c,u,d;return n(this,function(n){switch(n.label){case 0:return t.active?[4,t.pushManager.getSubscription()]:(setTimeout(function(){e._saveSubscriptionInfo(t)},500),a.Logger.info("Push Notification: Service Worker not activated yet, will retry after 1 second."),[2]);case 1:return(r=n.sent())?(c={info:JSON.stringify(r),glytics_did:g.DeviceService.getDeviceId(),env:o.Config.getEnv()},a.Logger.info("Push Notification: Saving existing subscribtion info."),[4,l.NetworkUtil.postToOldDcAsync("/sv_wpndt",c)]):[3,3];case 2:return u=n.sent(),a.Logger.info("Push Notification: Subscribtion info saved."),s.LocalStorage.setItem(s.StorageKeys.LastPushNotifReportedTime,Date.now().toString()),t.active.postMessage({label:"GRWLTCS",type:"GRW_CONFIG_WID",wid:u.data.id,vid:e.settings.vid},[]),a.Logger.info("Push Notification: Subscribtion locally updated."),[2];case 3:return n.trys.push([3,6,,7]),a.Logger.info("Push Notification: Subscribe for notifications started."),[4,t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e._urlBase64ToUint8Array(e.settings.vid)})];case 4:return i=n.sent(),a.Logger.info("Push Notification: Subscribed for notifications."),c={info:JSON.stringify(i),glytics_did:g.DeviceService.getDeviceId(),env:o.Config.getEnv()},a.Logger.info("Push Notification: Saving subscribtion info."),[4,l.NetworkUtil.postToOldDcAsync("/sv_wpndt",c)];case 5:return u=n.sent(),a.Logger.info("Push Notification: Saved subscribtion info."),a.Logger.info("Push Notification: Subscribtion info saved."),s.LocalStorage.setItem(s.StorageKeys.LastPushNotifReportedTime,Date.now().toString()),t.active.postMessage({label:"GRWLTCS",type:"GRW_CONFIG_WID",wid:u.data.id,vid:e.settings.vid},[]),a.Logger.info("Push Notification: Subscribtion locally updated."),[3,7];case 6:return d=n.sent(),a.Logger.error("Push Notification: Failed to subscribe for push notification.",d),[3,7];case 7:return[2]}})})},e._showPermissionBrowserDialog=function(){return i(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,Notification.requestPermission()];case 1:return"granted"===e.sent()?(a.Logger.info("Push Notification: Permission Granted. Saving info."),this._registerServiceWorker()):a.Logger.info("Push Notification: Request denied."),[2]}})})},e._registerServiceWorker=function(){return i(this,void 0,void 0,function(){var t,r,i,s;return n(this,function(n){switch(n.label){case 0:if(a.Logger.info("Push Notification: Registering Service Worker.",o.Config.getServiceWorkerFile()),this._isSubscriptionAlreadyReported())return a.Logger.info("Push Notification: Already reported skip."),[2];t=(t=o.Config.getServiceWorkerFile()).split("service-worker.js")[0],a.Logger.info("Push Notification: Service worker scope is",t),n.label=1;case 1:return n.trys.push([1,4,,5]),r=o.Config.getServiceWorkerFile()+"?v=2",a.Logger.info("Push Notification: Start: Service Worker.",r),[4,navigator.serviceWorker.register(r,{scope:t,updateViaCache:"none"})];case 2:return[4,(i=n.sent()).pushManager.getSubscription()];case 3:return n.sent(),i.active.postMessage({label:"GRWLTCS",type:"GRW_CONFIG_ID",id:o.Config.getApiKey()+"--"+o.Config.getEnv(),did:g.DeviceService.getDeviceId()},[]),a.Logger.info("Push Notification: Service Worker Registered."),e._saveSubscriptionInfo(i),[3,5];case 4:return s=n.sent(),a.Logger.error("Push Notification: Failed to register Serivce worker.",s),[2];case 5:return[2]}})})},e._showWebPushRequestUi=function(e){return i(this,void 0,void 0,function(){var t,r,i,l,g,d,f,p,h,v,y,w,b,m,S,L,_,k=this;return n(this,function(n){switch(n.label){case 0:if((t=s.LocalStorage.getItem(s.StorageKeys.StorageKeyForUIPermission))&&(r=parseInt(t),i=Date.now(),l=i-r,g=Math.floor(l/1e3/60/60),a.Logger.info("Push Notification: Last Requested: "+g+" hours ago."),d=e.askAgainAfter?parseInt(e.askAgainAfter):48,g<d))return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,u.UtilService.getHtmlTemplate(o.Config.getWebPushUiFile())];case 2:if(f=(f=(f=n.sent()).replace(/--title--/g,e.title)).replace(/--message--/g,e.message),f=e.icon?(f=f.replace(/--con-visibility--/g,"")).replace(/--icon-image--/g,'style="background-image: url('+e.icon+');"'):(f=f.replace(/--icon-visibility--/g,'style="display: none;"')).replace(/--icon-image--/g,""),e.displayPositionv1?(p=c.OnSiteBase.isMobileDevice()?e.displayPositionv1.mobile:e.displayPositionv1.desktop,h="grw-webpush-position-vertical-"+p.split("-")[0]+" ",h+="grw-webpush-position-horizontal-"+p.split("-")[1]+" ",f=f.replace(/--web-push-position--/g,h)):f=e.displayPosition?f.replace(/--web-push-position--/g,"grw-webpush-position-"+e.displayPosition):f.replace(/--web-push-position--/g,"grw-webpush-position-center"),f=(f=f.replace(/--accept-text--/g,e.acceptText)).replace(/--deny-text--/g,e.denyText),v='style="background: '+e.color+"; border-color: "+e.color+';"',f=f.replace(/--accept-style--/g,v),y='style="color: '+e.color+" !important; border-color: "+e.color+';"',f=f.replace(/--deny-style--/g,y),(w=document.createElement("style")).type="text/css",w.innerHTML="@keyframes grwWebPushAnimation {\n        0% {\n          transform: scale(0.1);\n          opacity: 0;\n        }\n  \n        60% {\n          transform: scale(1.2);\n          opacity: 1;\n        }\n  \n        100% {\n          transform: scale(1);\n        }\n      }",document.getElementsByTagName("head")[0].appendChild(w),(b=document.createElement("div")).innerHTML=f,b=b.firstChild,document.body.appendChild(b),document.getElementById("grw-webpush-confirm").onclick=function(){k._hideWebPushRequestUi(),k._showPermissionBrowserDialog()},document.getElementById("grw-webpush-cancel").onclick=function(){s.LocalStorage.setItem(s.StorageKeys.StorageKeyForUIPermission,Date.now().toString()),k._hideWebPushRequestUi()},m=["skinncells.myshopify.com","femella-in.myshopify.com"],window.Shopify&&m.indexOf(window.Shopify.shop)>=0)for(S=document.getElementsByClassName("grw-poweredby-container"),L=0;L<S.length;L++)S[L].style.display="none";return setTimeout(function(){var e=document.getElementsByClassName("grw-webpush-display-animation");e.length>0&&e[0].classList.remove("grw-webpush-display-animation")},1e3),[3,4];case 3:throw _=n.sent(),a.Logger.error("Failed to render webpush",_),_;case 4:return[2]}})})},e._hideWebPushRequestUi=function(){document.getElementById("grw-webpush-wrapper").remove()},e._isSubscriptionAlreadyReported=function(){var e=s.LocalStorage.getItem(s.StorageKeys.LastPushNotifReportedTime);if(!e)return!1;var t=parseInt(e),r=Date.now()-t,i=Math.floor(r/1e3/60/60/24);return a.Logger.info("Push Notification: Last Reporting Time: "+i+" days ago."),i<365},e._urlBase64ToUint8Array=function(e){for(var t="",r=1;r<=(4-e.length%4)%4;r++)t+="=";var i=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(i),o=new Uint8Array(n.length);for(r=0;r<n.length;++r)o[r]=n.charCodeAt(r);return o},e}();r.PushNotification=d},{"../utils/networkUtil":18,"./../onSite/onSiteBase":3,"./../utils/config":13,"./../utils/localStorage":16,"./../utils/logger":17,"./../utils/util":19,"./deviceService":7}],11:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r.__esModule=!0,r.SessionService=r.SessionStorageInfo=void 0;var o=e("../utils/localStorage"),s=e("../utils/logger"),a=e("../utils/networkUtil"),c=e("../utils/util"),u=e("./customerService"),l=e("./deviceService"),g=function(){return function(){this.sessionSpan=1800}}();r.SessionStorageInfo=g;var d=function(){function e(){}return e.isValidSession=function(){var t=!0,r=e.getCurrentSession();if(r){var i=Date.now();r.expiryTime<i&&(t=!1)}else t=!1;return t},e.getCurrentSession=function(){var e=o.LocalStorage.getItem(o.StorageKeys.SessionInfo);return e?e=JSON.parse(e):null},e.createAndReportNewSession=function(){return i(this,void 0,void 0,function(){var e,t,r,i;return n(this,function(n){switch(n.label){case 0:return e=c.UtilService.uuid(),t=this.getCurrentSession(),(r=new g).id=e,r.startTime=Date.now(),r.sessionSpan=30,r.expiryTime=r.startTime+60*r.sessionSpan*1e3,r.firstSession=!t,o.LocalStorage.setItem(o.StorageKeys.SessionInfo,JSON.stringify(r)),i={id:l.DeviceService.getDeviceId(),sid:u.CustomerService.getSystemId(),data:{urlPath:window.location.pathname?window.location.pathname.toString().substring(0,249):"",trafficSource:c.UtilService.readSourceForTracking()},session:r,meta:c.UtilService.buildDeviceMetaForReportingEvent()},[4,this._reportNewSessionToServer(i)];case 1:return n.sent(),[2]}})})},e._reportNewSessionToServer=function(e,t){return void 0===t&&(t=0),i(this,void 0,void 0,function(){return n(this,function(r){switch(r.label){case 0:return e.id?[3,4]:t<20?(0!=t&&t%5!=0||s.Logger.reportLogToServer(["warning","New Session Wait: Wait For DeviceId :",e]),[4,c.UtilService.sleep(500)]):[3,3];case 1:return r.sent(),t++,[4,this._reportNewSessionToServer(e,t)];case 2:return r.sent(),[2];case 3:return s.Logger.reportLogToServer(["error","Device profile not found for new session.",e]),[2];case 4:return[4,a.NetworkUtil.post(a.UrlList.NewSession,e)];case 5:return r.sent(),[2]}})})},e.extendExpiryTime=function(){return i(this,void 0,void 0,function(){var e,t;return n(this,function(r){return(e=this.getCurrentSession())?(t=Date.now(),e.expiryTime=t+60*e.sessionSpan*1e3,o.LocalStorage.setItem(o.StorageKeys.SessionInfo,JSON.stringify(e)),[2]):[2]})})},e}();r.SessionService=d},{"../utils/localStorage":16,"../utils/logger":17,"../utils/networkUtil":18,"../utils/util":19,"./customerService":6,"./deviceService":7}],12:[function(e,t,r){"use strict";r.__esModule=!0,r.EncryptionUtil=void 0;var i=function(){function e(){}return e.encrypt=function(e){return btoa(e)},e.decrypt=function(e){return atob(e)},e}();r.EncryptionUtil=i},{}],13:[function(e,t,r){"use strict";r.__esModule=!0,r.Config=void 0;var i=e("./endpointService"),n=function(){function e(){}return e.mergeOptions=function(e){if(!e.hasOwnProperty("apiKey"))throw new Error("Growlytics: Invalid configuration: apiKey not specified.");if(e.hasOwnProperty("enabled")&&"boolean"!=typeof e.enabled)throw new Error("Growlytics: Invalid configuration: enabled must be a boolean value.");if(e.hasOwnProperty("env")&&("string"!=typeof e.env||e.env.length>20))throw new Error("Growlytics: Invalid configuration: env must be a string of maximum 20 character limit.");this._enabled=!e.hasOwnProperty("enabled")||e.enabled,this._debug=!!e.hasOwnProperty("debug")&&e.debug,this._apiKey=e.apiKey,this._env=e.env?e.env:"production",this._serviceWorkerFile=e.hasOwnProperty("serviceWorkerFile")?e.serviceWorkerFile:this._serviceWorkerFile,this._webPushUiFile=e.hasOwnProperty("webPushTemplateFile")?e.webPushTemplateFile:this._webPushUiFile,this._rawConfig=e,i.EndpointService.setRawConfig(this._rawConfig)},e.getApiKey=function(){return this._apiKey},e.getEnv=function(){return this._env},e.isEnabled=function(){return this._enabled},e.setEnabled=function(e){this._enabled=e},e.debug=function(){return!(!window.sessionStorage||"1"!=window.sessionStorage.getItem("Growlytics-Debug"))||this._debug},e.isInitialized=function(){return this._initialized},e.setInitialized=function(e){this._initialized=e},e.getWebPushUiFile=function(){return this._webPushUiFile},e.getServiceWorkerFile=function(){return this._serviceWorkerFile},e._webPushUiFile="https://static.growlytics.in/web_push/webPush.html",e._serviceWorkerFile="/apps/growlytics/service-worker.js",e}();r.Config=n},{"./endpointService":14}],14:[function(e,t,r){"use strict";r.__esModule=!0,r.EndpointService=void 0;var i=function(){function e(){}return e.setRawConfig=function(e){this.rawConfig=e},e.getHost=function(){var e=null;return e=1==this.rawConfig.region?"https://dcqs-europe.growlytics.in":(this.rawConfig.region,"https://dcqs-india.growlytics.in"),this.rawConfig.hasOwnProperty("useDomain")&&(e=this.rawConfig.useDomain),this.rawConfig.hasOwnProperty("usePort")&&(e=e+":"+this.rawConfig.usePort),e},e.getOldHost=function(){return"https://dc2.growlytics.in"},e.getHostForWebMessage=function(){return this.rawConfig.hasOwnProperty("hostForWebMessage")?this.rawConfig.hostForWebMessage:"https://webmessage-v2.growlytics.in"},e.getHostForCache=function(){return this.getHost()},e}();r.EndpointService=i},{}],15:[function(e,t,r){function i(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,o(e,t,"get"))}function n(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,o(e,t,"set"),r),r}function o(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function s(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function c(e,t,r){a(e,t),t.set(e,r)}function u(e,t){a(e,t),t.add(e)}var l=[" daum[ /]"," deusu/","(?:^| )site","@[a-z]","\\(at\\)[a-z]","\\(github\\.com/","\\[at\\][a-z]","^12345","^<","^[\\w \\.\\-\\(\\)]+(/v?\\d+(\\.\\d+)?(\\.\\d{1,10})?)?$","^[^ ]{50,}$","^active","^ad muncher","^anglesharp/","^anonymous","^avsdevicesdk/","^axios/","^bidtellect/","^biglotron","^btwebclient/","^castro","^clamav[ /]","^client/","^cobweb/","^coccoc","^custom","^ddg[_-]android","^discourse","^dispatch/\\d","^downcast/","^duckduckgo","^facebook","^fdm[ /]\\d","^getright/","^gozilla/","^hatena","^hobbit","^hotzonu","^hwcdn/","^jeode/","^jetty/","^jigsaw","^linkdex","^lwp[-: ]","^metauri","^microsoft bits","^movabletype","^mozilla/\\d\\.\\d \\(compatible;?\\)$","^mozilla/\\d\\.\\d \\w*$","^navermailapp","^netsurf","^offline explorer","^php","^postman","^postrank","^python","^read","^reed","^restsharp/","^snapchat","^space bison","^svn","^swcd ","^taringa","^test certificate info","^thumbor/","^tumblr/","^user-agent:mozilla","^valid","^venus/fedoraplanet","^w3c","^webbandit/","^webcopier","^wget","^whatsapp","^xenu link sleuth","^yahoo","^yandex","^zdm/\\d","^zoom marketplace/","^{{.*}}$","adbeat\\.com","appinsights","archive","ask jeeves/teoma","bit\\.ly/","bluecoat drtr","bot","browsex","burpcollaborator","capture","catch","check","chrome-lighthouse","chromeframe","cloud","crawl","cryptoapi","dareboost","datanyze","dataprovider","dejaclick","dmbrowser","download","evc-batch/","feed","firephp","freesafeip","ghost","gomezagent","google","headlesschrome/","http","httrack","hubspot marketing grader","hydra","ibisbrowser","images","iplabel","ips-agent","java","library","mail\\.ru/","manager","monitor","morningscore/","neustar wpm","news","nutch","offbyone","optimize","pageburst","pagespeed","perl","phantom","pingdom","powermarks","preview","proxy","ptst[ /]\\d","reader","rexx;","rigor","rss","scan","scrape","search","serp ?reputation ?management","server","sogou","sparkler/","speedcurve","spider","statuscake","stumbleupon\\.com","supercleaner","synapse","synthetic","taginspector/","torrent","tracemyfile","transcoder","trendsmapresolver","twingly recon","url","virtuoso","wappalyzer","webglance","webkit2png","websitemetadataretriever","whatcms/","wordpress","zgrab"];!function(e){try{new RegExp("(?<! cu)bot").test("dangerbot")}catch(t){return e}[["bot","(?<! cu)bot"],["google","(?<! (?:channel/|google/))google(?!(app|/google| pixel))"],["http","(?<!(?:lib))http"],["java","java(?!;)"],["search","(?<! ya(?:yandex)?)search"]].forEach(t=>{let[r,i]=t;const n=e.lastIndexOf(r);~n&&e.splice(n,1,i)})}(l);const g="i";var d=new WeakMap,f=new WeakMap,p=new WeakSet,h=new WeakSet;class v{constructor(e){u(this,h),u(this,p),c(this,d,{writable:!0,value:void 0}),c(this,f,{writable:!0,value:void 0}),n(this,d,e||l.slice()),s(this,p,y).call(this);return Object.defineProperties(e=>this.test(e),Object.entries(Object.getOwnPropertyDescriptors(v.prototype)).reduce((e,t)=>{let[r,i]=t;return"function"==typeof i.value&&Object.assign(e,{[r]:{value:this[r].bind(this)}}),"function"==typeof i.get&&Object.assign(e,{[r]:{get:()=>this[r]}}),e},{}))}get pattern(){return new RegExp(i(this,f))}test(e){return Boolean(e)&&i(this,f).test(e)}find(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").match(i(this,f));return e&&e[0]}matches(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return i(this,d).filter(t=>new RegExp(t,g).test(e))}clear(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.exclude(this.matches(e))}extend(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];[].push.apply(i(this,d),e.filter(e=>-1===s(this,h,w).call(this,e)).map(e=>e.toLowerCase())),s(this,p,y).call(this)}exclude(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{length:t}=e;for(;t--;){const r=s(this,h,w).call(this,e[t]);r>-1&&i(this,d).splice(r,1)}s(this,p,y).call(this)}spawn(e){return new v(e||i(this,d))}}function y(){n(this,f,new RegExp(i(this,d).join("|"),g))}function w(e){return i(this,d).indexOf(e.toLowerCase())}const b=new v;t.exports=b},{}],16:[function(e,t,r){"use strict";r.__esModule=!0,r.LocalStorage=r.LocalState=r.StorageKeys=void 0;var i,n=e("./EncryptionUtil");!function(e){e.StorageKeyForUIPermission="LPNR",e.VisitorType="MSG-VT",e.WebMessageState="MSG-STAT",e.CustomerIdentified="CIS",e.LastPushNotifReportedTime="LPNS",e.LocalStorageData="DATA",e.SessionInfo="SSINF",e.SdkSettings="STG"}(i=r.StorageKeys||(r.StorageKeys={}));var o=function(){return function(){}}();r.LocalState=o;var s=function(){function e(){}return e.getItem=function(e){return window.localStorage.getItem(this.prefix+e)},e.setItem=function(e,t){return window.localStorage.setItem(this.prefix+e,t)},e.removeItem=function(e){return window.localStorage.removeItem(this.prefix+e)},e.getState=function(){var e=this.prefix+i.LocalStorageData,t=window.localStorage.getItem(e);if(!t)return null;var r=n.EncryptionUtil.decrypt(t);return JSON.parse(r)},e.setState=function(e){var t=this.prefix+i.LocalStorageData,r=n.EncryptionUtil.encrypt(JSON.stringify(e));return window.localStorage.setItem(t,r)},e.prefix="_GRWLTCS_",e}();r.LocalStorage=s},{"./EncryptionUtil":12}],17:[function(e,t,r){"use strict";r.__esModule=!0,r.Logger=void 0;var i=e("./config"),n=e("./networkUtil"),o=function(){function e(){}return e.debug=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=Array.prototype.slice.call(arguments,0);try{if(i.Config.debug())return console.log.apply(console,[e.LOG_PREFIX+": "].concat(n))}catch(e){}},e.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=Array.prototype.slice.call(arguments,0);try{if(i.Config.debug())return console.log.apply(console,[e.LOG_PREFIX+": "].concat(n))}catch(e){}},e.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=Array.prototype.slice.call(arguments,0);try{return console.log.apply(console,[e.LOG_PREFIX+": "].concat(i))}catch(e){}},e.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=Array.prototype.slice.call(arguments,0);try{return console.log.apply(console,[e.LOG_PREFIX+": "].concat(i))}catch(e){}},e.reportLogToServer=function(e){n.NetworkUtil.post(n.UrlList.DebugLogs,e)},e.LOG_PREFIX="Growlytics",e}();r.Logger=o},{"./config":13,"./networkUtil":18}],18:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r.__esModule=!0,r.NetworkUtil=r.NetworkCallResponse=r.NetworkCallErrorType=r.UrlList=void 0;var o,s=e("../service/deviceService"),a=e("./config"),c=e("./endpointService"),u=e("./logger");!function(e){e.DeviceRegisteration="/events/crd",e.NewSession="/events/ssn",e.NewEvent="/events/rpt",e.Login="/events/lgin",e.DebugLogs="/diagnostics",e.UpdateCustomerAttrs="/events/updt",e.Logout="/events/lgot",e.WebSdkSettings="/web-sdk/settings"}(r.UrlList||(r.UrlList={})),function(e){e.NonNetworkError="non-network",e.NetworkError="network"}(o=r.NetworkCallErrorType||(r.NetworkCallErrorType={}));var l=function(){return function(){}}();r.NetworkCallResponse=l;var g=function(){function e(){}return e.post=function(e,t,r){return void 0===r&&(r=null),i(this,void 0,void 0,function(){var i,s,g,d,f;return n(this,function(n){switch(n.label){case 0:i=new l,n.label=1;case 1:return n.trys.push([1,6,,7]),r||(r=c.EndpointService.getHost()),s=a.Config.getApiKey(),[4,fetch(r+e,{method:"POST",headers:{"Content-Type":"application/json","x-growlytics-key":s},body:JSON.stringify(t||{})})];case 2:return g=n.sent(),i.response=g,g.ok?[4,g.json()]:[3,4];case 3:return d=n.sent(),i.success=!0,i.data=d,[3,5];case 4:i.success=!1,i.errroType=o.NetworkError,n.label=5;case 5:return[3,7];case 6:return f=n.sent(),u.Logger.info("API Request Failed:",f),i.success=!1,i.error=f,i.errroType=o.NonNetworkError,[3,7];case 7:return[2,i]}})})},e.postToOldDcAsync=function(e,t){return i(this,void 0,void 0,function(){var r,i,s,g,d,f;return n(this,function(n){switch(n.label){case 0:r=new l,n.label=1;case 1:return n.trys.push([1,6,,7]),i=c.EndpointService.getOldHost(),s=a.Config.getApiKey(),[4,fetch(i+e,{method:"POST",headers:{"Content-Type":"application/json","x-growlytics-key":s},body:JSON.stringify(t||{})})];case 2:return g=n.sent(),r.response=g,g.ok?[4,g.json()]:[3,4];case 3:return d=n.sent(),r.success=!0,r.data=d,[3,5];case 4:r.success=!1,r.errroType=o.NetworkError,n.label=5;case 5:return[3,7];case 6:return f=n.sent(),u.Logger.info("API Request Failed:",f),r.success=!1,r.error=f,r.errroType=o.NonNetworkError,[3,7];case 7:return[2,r]}})})},e.postToOldDc=function(e,t,r,o,u){return void 0===u&&(u=null),i(this,void 0,void 0,function(){var i,l,g,d;return n(this,function(n){return t.glytics_did=s.DeviceService.getDeviceId(),i=c.EndpointService.getOldHost(),i=c.EndpointService.getOldHost(),u&&(i=u),l=a.Config.getApiKey(),g=a.Config.getEnv(),(d=new window.XMLHttpRequest).open("POST",i+e),d.onreadystatechange=function(){if(d.readyState===window.XMLHttpRequest.DONE)if(401==d.status)a.Config.setEnabled(!1),o("Growlytics: Invalid credentials. Please provide valid project id and api key. Disabling Growlytics Plugin.");else if(200==d.status){(e=JSON.parse(d.response)).success?r(e.data):o(e.msg)}else if(422==d.status){var e=d.response?JSON.parse(d.response):null;o("Invalid input.",d.status,e)}else o("Failure response.",d.status,null)},d.setRequestHeader("Content-Type","application/json"),d.setRequestHeader("glytics_api_key",l),d.setRequestHeader("glytics_env",g),d.send(JSON.stringify(t)),[2]})})},e}();r.NetworkUtil=g},{"../service/deviceService":7,"./config":13,"./endpointService":14,"./logger":17}],19:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r.__esModule=!0,r.UtilService=void 0;var o=e("./logger"),s=function(){function e(){}return e.uuid=function(){var e=null;if(window.crypto&&window.crypto.randomUUID)e=window.crypto.randomUUID();else{var t=(new Date).getTime();e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})}return e},e.elementHasClass=function(e,t){return!!(e.className&&e.className.split(" ").indexOf(t)>=0)},e.readQueryString=function(e){for(var t={},r=(e||window.location.search.substring(1)).split("&"),i=0;i<r.length;i++){var n=r[i].split("=");if(void 0===t[n[0]])t[n[0]]=n[1];else if("string"==typeof t[n[0]]){var o=[t[n[0]],n[1]];t[n[0]]=o}else t[n[0]].push(n[1])}return t},e.readSourceForTracking=function(){var e=this.readQueryString(null),t=null;if(void 0!==e.utm_source||void 0!==e.utm_medium||void 0!==e.utm_campaign||void 0!==e.utm_content||void 0!==e.utm_term||void 0!==e.gclid||void 0!==e.yclid){if(t={},void 0!==e.utm_source)try{t.us=decodeURIComponent(e.utm_source)}catch(r){t.us=e.utm_source}else void 0!==e.gclid?t.us="google":void 0!==e.yclid?t.us="yandex":t.us="none";if(void 0!==e.utm_medium)try{t.um=decodeURIComponent(e.utm_medium)}catch(r){t.um=e.utm_medium}else void 0!==e.gclid?t.um="cpc":void 0!==e.yclid?t.um="cpc":t.um="none";if(void 0!==e.utm_campaign)try{t.uc=decodeURIComponent(e.utm_campaign)}catch(r){t.uc=e.utm_campaign}else if(void 0!==e[e.campaign_param])try{t.uc=decodeURIComponent(e[e.campaign_param])}catch(r){t.uc=e[e.campaign_param]}else void 0!==e.gclid?t.uc="google_cpc":void 0!==e.yclid?t.uc="yandex_cpc":t.uc="none"}else void 0!==e.ref&&((t={}).us=e.ref);var r=document.referrer;if(r)try{var i=document.createElement("a");i.href=r;var n=i.hostname;r=n=n.replace("www.","")}catch(e){r="direct"}return r||(r="direct"),{utm:t,referrer:r}},e.sleep=function(e){return i(this,void 0,void 0,function(){return n(this,function(t){return[2,new Promise(function(t){return setTimeout(t,e)})]})})},e.getHtmlTemplate=function(e,t){return void 0===t&&(t="plain/text"),i(this,void 0,void 0,function(){var r,i;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),[4,fetch(e,{method:"GET",headers:{"Content-Type":t}})];case 1:return(r=n.sent()).ok?[4,r.text()]:[3,3];case 2:return[2,n.sent()];case 3:throw new Error("Response: "+r.status);case 4:return[3,6];case 5:throw i=n.sent(),o.Logger.error("Failed to fetch html templates:",i),i;case 6:return[2]}})})},e.buildDeviceMetaForReportingEvent=function(){return{deviceTs:Date.now(),deviceTz:"-330",deviceTzOffset:198e5.toString(),ua:window.navigator.userAgent}},e}();r.UtilService=s},{"./logger":17}]},{},[1]);